<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>monitor | sys-doc</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/sys-doc/assets/css/0.styles.f2c13968.css" as="style"><link rel="preload" href="/sys-doc/assets/js/app.fd566854.js" as="script"><link rel="preload" href="/sys-doc/assets/js/2.01d9652a.js" as="script"><link rel="preload" href="/sys-doc/assets/js/21.03ded64d.js" as="script"><link rel="prefetch" href="/sys-doc/assets/js/10.331427a7.js"><link rel="prefetch" href="/sys-doc/assets/js/11.89b28dfb.js"><link rel="prefetch" href="/sys-doc/assets/js/12.7136e253.js"><link rel="prefetch" href="/sys-doc/assets/js/13.a1feb60a.js"><link rel="prefetch" href="/sys-doc/assets/js/14.b0c7cf4d.js"><link rel="prefetch" href="/sys-doc/assets/js/15.28671588.js"><link rel="prefetch" href="/sys-doc/assets/js/16.edc12257.js"><link rel="prefetch" href="/sys-doc/assets/js/17.13d64156.js"><link rel="prefetch" href="/sys-doc/assets/js/18.61d35156.js"><link rel="prefetch" href="/sys-doc/assets/js/19.05bd98c3.js"><link rel="prefetch" href="/sys-doc/assets/js/20.a0cf136a.js"><link rel="prefetch" href="/sys-doc/assets/js/22.48cb9c16.js"><link rel="prefetch" href="/sys-doc/assets/js/23.0c180cf1.js"><link rel="prefetch" href="/sys-doc/assets/js/24.77e09a3e.js"><link rel="prefetch" href="/sys-doc/assets/js/25.e55672d9.js"><link rel="prefetch" href="/sys-doc/assets/js/26.e11de8a1.js"><link rel="prefetch" href="/sys-doc/assets/js/27.e81e4d27.js"><link rel="prefetch" href="/sys-doc/assets/js/28.86516cc2.js"><link rel="prefetch" href="/sys-doc/assets/js/29.aa1feb8e.js"><link rel="prefetch" href="/sys-doc/assets/js/3.20c33c5a.js"><link rel="prefetch" href="/sys-doc/assets/js/30.18bddb07.js"><link rel="prefetch" href="/sys-doc/assets/js/31.0c0fc3f6.js"><link rel="prefetch" href="/sys-doc/assets/js/32.e314141f.js"><link rel="prefetch" href="/sys-doc/assets/js/33.245c25a8.js"><link rel="prefetch" href="/sys-doc/assets/js/34.97b50b49.js"><link rel="prefetch" href="/sys-doc/assets/js/35.416394de.js"><link rel="prefetch" href="/sys-doc/assets/js/36.0f98bd03.js"><link rel="prefetch" href="/sys-doc/assets/js/37.dfbffb38.js"><link rel="prefetch" href="/sys-doc/assets/js/38.cf3be4f4.js"><link rel="prefetch" href="/sys-doc/assets/js/39.5e3f13bc.js"><link rel="prefetch" href="/sys-doc/assets/js/4.ba3164ba.js"><link rel="prefetch" href="/sys-doc/assets/js/40.833df0a0.js"><link rel="prefetch" href="/sys-doc/assets/js/41.3bdce96b.js"><link rel="prefetch" href="/sys-doc/assets/js/42.6b2020fe.js"><link rel="prefetch" href="/sys-doc/assets/js/43.fbda1738.js"><link rel="prefetch" href="/sys-doc/assets/js/44.83fa6178.js"><link rel="prefetch" href="/sys-doc/assets/js/45.0852ddf5.js"><link rel="prefetch" href="/sys-doc/assets/js/46.990d694d.js"><link rel="prefetch" href="/sys-doc/assets/js/47.139e0ce7.js"><link rel="prefetch" href="/sys-doc/assets/js/48.4727a0e7.js"><link rel="prefetch" href="/sys-doc/assets/js/49.047e16f6.js"><link rel="prefetch" href="/sys-doc/assets/js/5.75a3592b.js"><link rel="prefetch" href="/sys-doc/assets/js/50.8c5f4526.js"><link rel="prefetch" href="/sys-doc/assets/js/51.52b6b0a5.js"><link rel="prefetch" href="/sys-doc/assets/js/52.ed0d03ac.js"><link rel="prefetch" href="/sys-doc/assets/js/53.e811a10a.js"><link rel="prefetch" href="/sys-doc/assets/js/54.304d6614.js"><link rel="prefetch" href="/sys-doc/assets/js/55.6ca0d272.js"><link rel="prefetch" href="/sys-doc/assets/js/56.af156023.js"><link rel="prefetch" href="/sys-doc/assets/js/57.beebccbe.js"><link rel="prefetch" href="/sys-doc/assets/js/58.13f50977.js"><link rel="prefetch" href="/sys-doc/assets/js/59.16a170c2.js"><link rel="prefetch" href="/sys-doc/assets/js/6.0377ba0c.js"><link rel="prefetch" href="/sys-doc/assets/js/60.087b4537.js"><link rel="prefetch" href="/sys-doc/assets/js/61.81939771.js"><link rel="prefetch" href="/sys-doc/assets/js/62.0add7894.js"><link rel="prefetch" href="/sys-doc/assets/js/63.186c3c30.js"><link rel="prefetch" href="/sys-doc/assets/js/64.028bd565.js"><link rel="prefetch" href="/sys-doc/assets/js/65.432bd1e5.js"><link rel="prefetch" href="/sys-doc/assets/js/66.49d8330c.js"><link rel="prefetch" href="/sys-doc/assets/js/67.103fb1bb.js"><link rel="prefetch" href="/sys-doc/assets/js/68.4df1cd9f.js"><link rel="prefetch" href="/sys-doc/assets/js/69.c1980d62.js"><link rel="prefetch" href="/sys-doc/assets/js/7.e59ee139.js"><link rel="prefetch" href="/sys-doc/assets/js/70.24c3d817.js"><link rel="prefetch" href="/sys-doc/assets/js/71.fe1caa2d.js"><link rel="prefetch" href="/sys-doc/assets/js/72.12db8d61.js"><link rel="prefetch" href="/sys-doc/assets/js/73.1a37bc6b.js"><link rel="prefetch" href="/sys-doc/assets/js/74.57baf573.js"><link rel="prefetch" href="/sys-doc/assets/js/75.e91134ec.js"><link rel="prefetch" href="/sys-doc/assets/js/76.8ce76e46.js"><link rel="prefetch" href="/sys-doc/assets/js/77.0434c218.js"><link rel="prefetch" href="/sys-doc/assets/js/78.3006b6fa.js"><link rel="prefetch" href="/sys-doc/assets/js/79.62e05f66.js"><link rel="prefetch" href="/sys-doc/assets/js/8.9202dc84.js"><link rel="prefetch" href="/sys-doc/assets/js/80.0458d82e.js"><link rel="prefetch" href="/sys-doc/assets/js/81.6343369c.js"><link rel="prefetch" href="/sys-doc/assets/js/9.fde67e0a.js">
    <link rel="stylesheet" href="/sys-doc/assets/css/0.styles.f2c13968.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/sys-doc/" class="home-link router-link-active"><img src="/sys-doc/imgs/logo.jpeg" alt="sys-doc" class="logo"> <span class="site-name can-hide">sys-doc</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/sys-doc/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/sys-doc/programme/" class="nav-link">
  编程
</a></div><div class="nav-item"><a href="/sys-doc/engineer/" class="nav-link">
  工程
</a></div><div class="nav-item"><a href="/sys-doc/framework/" class="nav-link router-link-active">
  架构
</a></div><div class="nav-item"><a href="/sys-doc/shell/" class="nav-link">
  集锦
</a></div><div class="nav-item"><a href="/sys-doc/leetCode/" class="nav-link">
  LCode
</a></div> <a href="https://github.com/chttyCode/sys-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/sys-doc/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/sys-doc/programme/" class="nav-link">
  编程
</a></div><div class="nav-item"><a href="/sys-doc/engineer/" class="nav-link">
  工程
</a></div><div class="nav-item"><a href="/sys-doc/framework/" class="nav-link router-link-active">
  架构
</a></div><div class="nav-item"><a href="/sys-doc/shell/" class="nav-link">
  集锦
</a></div><div class="nav-item"><a href="/sys-doc/leetCode/" class="nav-link">
  LCode
</a></div> <a href="https://github.com/chttyCode/sys-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/sys-doc/framework/" aria-current="page" class="sidebar-link">framework</a></li><li><a href="/sys-doc/framework/monitor.html" aria-current="page" class="active sidebar-link">monitor</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/sys-doc/framework/monitor.html#指标分类" class="sidebar-link">指标分类</a></li><li class="sidebar-sub-header"><a href="/sys-doc/framework/monitor.html#监控方案" class="sidebar-link">监控方案</a></li><li class="sidebar-sub-header"><a href="/sys-doc/framework/monitor.html#监控错误" class="sidebar-link">监控错误</a></li><li class="sidebar-sub-header"><a href="/sys-doc/framework/monitor.html#体验" class="sidebar-link">体验</a></li><li class="sidebar-sub-header"><a href="/sys-doc/framework/monitor.html#参考" class="sidebar-link">参考</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>运维</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="monitor"><a href="#monitor" class="header-anchor">#</a> monitor</h1> <h1 id="monitor-2"><a href="#monitor-2" class="header-anchor">#</a> monitor</h1> <h2 id="指标分类"><a href="#指标分类" class="header-anchor">#</a> 指标分类</h2> <ul><li><p>稳定性(stability)</p> <ul><li>JS 错误 JS 执行错误或者 promise 异常</li> <li>资源异常 script、link 等资源加载异常</li> <li>接口错误 ajax 或 fetch 请求接口异常</li> <li>白屏 页面空白</li></ul></li> <li><p>用户体验(experience)</p> <ul><li>加载时间 各个阶段的加载时间</li> <li>TTFB(time to first byte)(首字节时间) 是指浏览器发起第一个请求到数据返回第一个字节所消耗的时间，这个时间包含了网络请求时间、后端处理时间</li> <li>FP(First Paint)(首次绘制) 首次绘制包括了任何用户自定义的背景绘制，它是将第一个像素点绘制到屏幕的时刻</li> <li>FCP(First Content Paint)(首次内容绘制) 首次内容绘制是浏览器将第一个 DOM 渲染到屏幕的时间,可以是任何文本、图像、SVG 等的时间</li> <li>FMP(First Meaningful paint)(首次有意义绘制) 首次有意义绘制是页面可用性的量度标准</li> <li>FID(First Input Delay)(首次输入延迟) 用户首次和页面交互到页面响应交互的时间</li> <li>卡顿 超过 50ms 的长任务</li></ul></li> <li><p>业务(business)</p> <ul><li>PV page view 即页面浏览量或点击量</li> <li>UV 指访问某个站点的不同 IP 地址的人数</li> <li>页面的停留时间 用户在每一个页面的停留时间</li></ul> <h2 id="监控方案"><a href="#监控方案" class="header-anchor">#</a> 监控方案</h2> <ul><li>代码埋点：以嵌入代码方式进行监控
<ul><li>优点:
<ul><li>精细</li></ul></li> <li>缺点：
<ul><li>量大</li></ul></li></ul></li></ul></li> <li><p>无痕埋点：监控某一类全局事件</p> <ul><li>优点
<ul><li>全</li> <li>无侵入</li></ul></li> <li>缺点
<ul><li>数据量大</li></ul></li></ul></li></ul> <h2 id="监控错误"><a href="#监控错误" class="header-anchor">#</a> 监控错误</h2> <ul><li>封装请求方法
<ul><li>tracker</li></ul></li> <li>错误分类
<ul><li>js 错误
<ul><li>监控 error 事件</li> <li>定义上报格式</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
      kind<span class="token operator">:</span> <span class="token string">'stability'</span><span class="token punctuation">,</span> <span class="token comment">//监控指标的大类</span>
      type<span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token comment">//小类型 这是一个错误</span>
      errorType<span class="token operator">:</span> <span class="token string">'jsError'</span><span class="token punctuation">,</span> <span class="token comment">//JS执行错误</span>
      message<span class="token operator">:</span> event<span class="token punctuation">.</span>message<span class="token punctuation">,</span> <span class="token comment">//报错信息</span>
      filename<span class="token operator">:</span> event<span class="token punctuation">.</span>filename<span class="token punctuation">,</span> <span class="token comment">//哪个文件报错了</span>
      position<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>lineno<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>colno<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      stack<span class="token operator">:</span> <span class="token function">getLines</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>error<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">,</span>
      selector<span class="token operator">:</span> lastEvent <span class="token operator">?</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>lastEvent<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">//代表最后一个操作的元素</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>获取最后一个交互对象
<ul><li>在捕获阶段记录</li> <li>阻止默认事件</li></ul></li> <li>解析 stack
<ul><li>格式化输出</li> <li>? 如何做好与源码的映射关系</li></ul></li> <li>脚本错误
<ul><li>脚本加载执行错误
<ul><li>属于 js 执行错误</li></ul></li> <li>脚本 404
<ul><li>资源加载错误，必须在捕获阶段监听 error 事件</li></ul></li></ul></li> <li>selector: 定位元素
<ul><li>资源错误</li> <li>执行错误</li></ul></li></ul></li> <li>promise 错误</li></ul></li> <li>资源异常
<ul><li>监听 error</li></ul></li> <li>接口错误</li> <li>白屏
<ul><li>类型
<ul><li>首页白屏</li> <li>代码崩溃白屏</li></ul></li> <li>白屏监控方案
<ul><li>监控时机
<ul><li>onerror</li> <li>mutation observer api</li> <li>轮训</li></ul></li> <li>DOM 检测
<ul><li>elementsFromPoint</li> <li>图像识别</li> <li>基于 DOM 数据算法识别</li></ul></li></ul></li> <li>采用基于 elementsFromPoint 的方案
<ul><li>注册监听
<ul><li>其中 state 值包含下面三个值
<ul><li>loading: 表示文档正在加载中。</li> <li>interactive: 表示文档已完成加载，文档已被解析，但图像、样式表和框架等子资源仍在加载。</li> <li>complete: 表示文档和所有子资源已完成加载。如果状态变成这个，表明 load 事件即将触发</li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/readystatechange_event" target="_blank" rel="noopener noreferrer">Document: readystatechange 事件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.zhangxinxu.com/wordpress/2019/10/document-readystate/" target="_blank" rel="noopener noreferrer">幸好 document.readyState 还是有点锤子用的<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></li> <li>采点
<ul><li>document.elementsFromPoint()，该函数返还在特定坐标点下的 HTML 元素数组。</li> <li>采用十字交叉轴上的 18 个点</li></ul></li></ul></li></ul></li></ul> <h2 id="体验"><a href="#体验" class="header-anchor">#</a> 体验</h2> <ul><li><p>性能指标</p> <ul><li>指标
<table><thead><tr><th>字段</th> <th>描述</th> <th>备注</th></tr></thead> <tbody><tr><td>FP</td> <td>First Paint(首次绘制)</td> <td>包括了任何用户自定义的背景绘制，它是首先将像素绘制到屏幕的时刻</td></tr> <tr><td>FCP</td> <td>First Content Paint(首次内容绘制)</td> <td>是浏览器将第一个 DOM 渲染到屏幕的时间,可能是文本、图像、SVG 等,这其实就是白屏时间</td></tr> <tr><td>FMP</td> <td>First Meaningful Paint(首次有意义绘制)</td> <td>页面有意义的内容渲染的时间</td></tr> <tr><td>LCP</td> <td>(Largest Contentful Paint)(最大内容渲染)</td> <td>代表在 viewport 中最大的页面元素加载的时间</td></tr> <tr><td>DCL</td> <td>(DomContentLoaded)(DOM 加载完成)</td> <td>当 HTML 文档被完全加载和解析完成之后,DOMContentLoaded 事件被触发，无需等待样式表、图像和子框架的完成加载</td></tr> <tr><td></td> <td>(onLoad)</td> <td>当依赖的资源全部加载完毕之后才会触发</td></tr> <tr><td>TTI</td> <td>(Time to Interactive) 可交互时间</td> <td>用于标记应用已进行视觉渲染并能可靠响应用户输入的时间点</td></tr> <tr><td>FID</td> <td>First Input Delay(首次输入延迟)</td> <td>用户首次和页面交互(单击链接，点击按钮等)到页面响应交互的时间</td></tr></tbody></table></li> <li>PerformanceObserver: 使用观察者模式进行性能指标统计</li> <li>指定检测 entry types 集合，当检测有变化时回调函数会被调用
<ul><li>element:FMP
<ul><li>检测特性有属性 elementtiming 的元素</li> <li>可以自定义页面有意义的元素，进行统计</li></ul></li> <li>largest-contentful-paint <a href="https://segmentfault.com/a/1190000039842975" target="_blank" rel="noopener noreferrer">最大的内容绘制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>first-input:
<ul><li>浏览器收到 click 事件到主线程得空处理它之间存在延迟。<a href="https://segmentfault.com/a/1190000039843026?utm_source=tag-newest" target="_blank" rel="noopener noreferrer">首次输入延迟<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></li></ul></li> <li><p>加载时间</p> <ul><li><p>加载时间统计</p> <table><thead><tr><th>字段</th> <th>含义</th></tr></thead> <tbody><tr><td>navigationStart</td> <td>初始化页面，在同一个浏览器上下文中前一个页面 unload 的时间戳，如果没有前一个页面的 unload,则与 fetchStart 值相等</td></tr> <tr><td>redirectStart</td> <td>第一个 HTTP 重定向发生的时间,有跳转且是同域的重定向,否则为 0</td></tr> <tr><td>redirectEnd</td> <td>最后一个重定向完成时的时间,否则为 0</td></tr> <tr><td>fetchStart</td> <td>浏览器准备好使用 http 请求获取文档的时间,这发生在检查缓存之前</td></tr> <tr><td>domainLookupStart</td> <td>DNS 域名开始查询的时间,如果有本地的缓存或 keep-alive 则时间为 0</td></tr> <tr><td>domainLookupEnd</td> <td>DNS 域名结束查询的时间</td></tr> <tr><td>connectStart</td> <td>TCP 开始建立连接的时间,如果是持久连接,则与 fetchStart 值相等</td></tr> <tr><td>secureConnectionStart</td> <td>https 连接开始的时间,如果不是安全连接则为 0</td></tr> <tr><td>connectEnd</td> <td>TCP 完成握手的时间，如果是持久连接则与 fetchStart 值相等</td></tr> <tr><td>requestStart</td> <td>HTTP 请求读取真实文档开始的时间,包括从本地缓存读取</td></tr> <tr><td>requestEnd</td> <td>HTTP 请求读取真实文档结束的时间,包括从本地缓存读取</td></tr> <tr><td>responseStart</td> <td>返回浏览器从服务器收到（或从本地缓存读取）第一个字节时的 Unix 毫秒时间戳</td></tr> <tr><td>responseEnd</td> <td>返回浏览器从服务器收到（或从本地缓存读取，或从本地资源读取）最后一个字节时的 Unix 毫秒时间戳</td></tr> <tr><td>unloadEventStart</td> <td>前一个页面的 unload 的时间戳 如果没有则为 0</td></tr> <tr><td>unloadEventEnd</td> <td>与 unloadEventStart 相对应，返回的是 unload 函数执行完成的时间戳</td></tr> <tr><td>domLoading</td> <td>返回当前网页 DOM 结构开始解析时的时间戳,此时 document.readyState 变成 loading,并将抛出 readyStateChange 事件</td></tr> <tr><td>domInteractive</td> <td>返回当前网页 DOM 结构结束解析、开始加载内嵌资源时时间戳,document.readyState 变成 interactive，并将抛出 readyStateChange 事件(注意只是 DOM 树解析完成,这时候并没有开始加载网页内的资源)</td></tr> <tr><td>domContentLoadedEventStart</td> <td>网页 domContentLoaded 事件发生的时间</td></tr> <tr><td>domContentLoadedEventEnd</td> <td>网页 domContentLoaded 事件脚本执行完毕的时间,domReady 的时间</td></tr> <tr><td>domComplete</td> <td>DOM 树解析完成,且资源也准备就绪的时间,document.readyState 变成 complete.并将抛出 readystatechange 事件</td></tr> <tr><td>loadEventStart</td> <td>load 事件发送给文档，也即 load 回调函数开始执行的时间</td></tr> <tr><td>loadEventEnd</td> <td>load 回调函数执行完成的时间</td></tr></tbody></table></li> <li><p>阶段计算</p></li></ul> <table><thead><tr><th>字段</th> <th>描述</th> <th>计算方式</th> <th>意义</th></tr></thead> <tbody><tr><td>unload</td> <td>前一个页面卸载耗时</td> <td>unloadEventEnd – unloadEventStart</td> <td>-</td></tr> <tr><td>redirect</td> <td>重定向耗时</td> <td>redirectEnd – redirectStart 重定向的时间</td> <td></td></tr> <tr><td>appCache</td> <td>缓存耗时</td> <td>domainLookupStart – fetchStart</td> <td>读取缓存的时间</td></tr> <tr><td>dns</td> <td>DNS 解析耗时</td> <td>domainLookupEnd – domainLookupStart</td> <td>可观察域名解析服务是否正常</td></tr> <tr><td>tcp</td> <td>TCP 连接耗时</td> <td>connectEnd – connectStart</td> <td>建立连接的耗时</td></tr> <tr><td>ssl</td> <td>SSL 安全连接耗时</td> <td>connectEnd – secureConnectionStart</td> <td>反映数据安全连接建立耗时</td></tr> <tr><td>ttfb</td> <td>Time to First Byte(TTFB)网络请求耗时</td> <td>responseStart – requestStart</td> <td>TTFB 是发出页面请求到接收到应答数据第一个字节所花费的毫秒数</td></tr> <tr><td>response</td> <td>响应数据传输耗时</td> <td>responseEnd – responseStart</td> <td>观察网络是否正常</td></tr> <tr><td>dom</td> <td>DOM 解析耗时</td> <td>domInteractive – responseEnd</td> <td>观察 DOM 结构是否合理，是否有 JS 阻塞页面解析</td></tr> <tr><td>dcl</td> <td>DOMContentLoaded 事件耗时</td> <td>domContentLoadedEventEnd – domContentLoadedEventStart</td> <td>当 HTML 文档被完全加载和解析完成之后，DOMContentLoaded 事件被触发，无需等待样式表、图像和子框架的完成加载</td></tr> <tr><td>resources</td> <td>资源加载耗时</td> <td>domComplete – domContentLoadedEventEnd</td> <td>可观察文档流是否过大</td></tr> <tr><td>domReady</td> <td>DOM 阶段渲染耗时</td> <td>domContentLoadedEventEnd – fetchStart</td> <td>DOM 树和页面资源加载完成时间，会触发 domContentLoaded 事件</td></tr> <tr><td>首次渲染耗时</td> <td>首次渲染耗时</td> <td>responseEnd-fetchStart</td> <td>加载文档到看到第一帧非空图像的时间，也叫白屏时间</td></tr> <tr><td>首次可交互时间</td> <td>首次可交互时间</td> <td>domInteractive-fetchStart</td> <td>DOM 树解析完成时间，此时 document.readyState 为 interactive</td></tr> <tr><td>首包时间耗时</td> <td>首包时间</td> <td>responseStart-domainLookupStart</td> <td>DNS 解析到响应返回给浏览器第一个字节的时间</td></tr> <tr><td>页面完全加载时间</td> <td>页面完全加载时间</td> <td>loadEventStart - fetchStart</td> <td>-</td></tr> <tr><td>onLoad</td> <td>onLoad 事件耗时</td> <td>loadEventEnd – loadEventStart</td> <td></td></tr></tbody></table></li> <li><p>卡顿</p> <ul><li>PerformanceObserver entryTypes: [&quot;longtask&quot;]</li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestIdleCallback" target="_blank" rel="noopener noreferrer">requestIdleCallback<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li>存在兼容性问题，可通过 requestAnimationFrame+任务队列模拟，可参考编程-react-源码的实现方式</li></ul></li></ul></li> <li><p>PV</p> <ul><li>navigator.connection</li></ul></li> <li><p>在线时长</p> <ul><li>页面卸载时上报数据</li> <li>解决方案
<ul><li>在 unload 回调中创建图片来上报数据或通过创建一个几秒钟的 no-op 循环来延迟卸载并向服务器发送数据</li> <li>通过 unload 同步请求
<ul><li>会导致页面卸载被延迟</li></ul></li> <li>sendBeacon()
<ul><li>数据量小</li> <li>兼容性差</li></ul></li></ul></li></ul></li></ul> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <blockquote><p><a href="https://mp.weixin.qq.com/s/YiKRY_LDURY0uONtEhkUfg" target="_blank" rel="noopener noreferrer">大前端时代前端监控的最佳实践<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p><a href="https://mp.weixin.qq.com/s?__biz=MjM5MTA1MjAxMQ==&amp;mid=2651227494&amp;idx=1&amp;sn=444001447adef73ae8066ddfd1a01ddc&amp;chksm=bd495ce28a3ed5f4f593dcacc315cbce554330230b8a56bcd5c980dcf4eb76cb5c4f3eaa8f12&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">把前端监控做到极致<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p><a href="https://mp.weixin.qq.com/s?__biz=MjM5MTA1MjAxMQ==&amp;mid=2651225487&amp;idx=1&amp;sn=060f827234606cd3e9a3771d67af4d0f&amp;chksm=bd49a40b8a3e2d1dc9ed064543e236312e99a63e50987ae143012967366a1f691eff67a8ae1b&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">如何设计一个前端监控系统<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/chttyCode/sys-doc/edit/master/docs/framework/monitor.md" target="_blank" rel="noopener noreferrer">编辑此内容</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021/12/25</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/sys-doc/framework/" class="prev router-link-active">
        framework
      </a></span> <span class="next"><a href="/sys-doc/framework/ops-linux.html">
        Linux
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/sys-doc/assets/js/app.fd566854.js" defer></script><script src="/sys-doc/assets/js/2.01d9652a.js" defer></script><script src="/sys-doc/assets/js/21.03ded64d.js" defer></script>
  </body>
</html>
