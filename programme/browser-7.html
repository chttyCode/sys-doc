<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>安全 | sys-doc</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/sys-doc/assets/css/0.styles.f2c13968.css" as="style"><link rel="preload" href="/sys-doc/assets/js/app.4dbaeb20.js" as="script"><link rel="preload" href="/sys-doc/assets/js/2.01d9652a.js" as="script"><link rel="preload" href="/sys-doc/assets/js/39.6d8c0228.js" as="script"><link rel="prefetch" href="/sys-doc/assets/js/10.331427a7.js"><link rel="prefetch" href="/sys-doc/assets/js/11.89b28dfb.js"><link rel="prefetch" href="/sys-doc/assets/js/12.7136e253.js"><link rel="prefetch" href="/sys-doc/assets/js/13.a1feb60a.js"><link rel="prefetch" href="/sys-doc/assets/js/14.b0c7cf4d.js"><link rel="prefetch" href="/sys-doc/assets/js/15.28671588.js"><link rel="prefetch" href="/sys-doc/assets/js/16.edc12257.js"><link rel="prefetch" href="/sys-doc/assets/js/17.13d64156.js"><link rel="prefetch" href="/sys-doc/assets/js/18.61d35156.js"><link rel="prefetch" href="/sys-doc/assets/js/19.05bd98c3.js"><link rel="prefetch" href="/sys-doc/assets/js/20.a0cf136a.js"><link rel="prefetch" href="/sys-doc/assets/js/21.03ded64d.js"><link rel="prefetch" href="/sys-doc/assets/js/22.48cb9c16.js"><link rel="prefetch" href="/sys-doc/assets/js/23.0c180cf1.js"><link rel="prefetch" href="/sys-doc/assets/js/24.77e09a3e.js"><link rel="prefetch" href="/sys-doc/assets/js/25.e55672d9.js"><link rel="prefetch" href="/sys-doc/assets/js/26.e11de8a1.js"><link rel="prefetch" href="/sys-doc/assets/js/27.e81e4d27.js"><link rel="prefetch" href="/sys-doc/assets/js/28.86516cc2.js"><link rel="prefetch" href="/sys-doc/assets/js/29.c7035495.js"><link rel="prefetch" href="/sys-doc/assets/js/3.50da570f.js"><link rel="prefetch" href="/sys-doc/assets/js/30.18bddb07.js"><link rel="prefetch" href="/sys-doc/assets/js/31.0c0fc3f6.js"><link rel="prefetch" href="/sys-doc/assets/js/32.e314141f.js"><link rel="prefetch" href="/sys-doc/assets/js/33.245c25a8.js"><link rel="prefetch" href="/sys-doc/assets/js/34.98ca6147.js"><link rel="prefetch" href="/sys-doc/assets/js/35.416394de.js"><link rel="prefetch" href="/sys-doc/assets/js/36.189ed700.js"><link rel="prefetch" href="/sys-doc/assets/js/37.ea3b68b8.js"><link rel="prefetch" href="/sys-doc/assets/js/38.7779b874.js"><link rel="prefetch" href="/sys-doc/assets/js/4.ba3164ba.js"><link rel="prefetch" href="/sys-doc/assets/js/40.833df0a0.js"><link rel="prefetch" href="/sys-doc/assets/js/41.e15859ac.js"><link rel="prefetch" href="/sys-doc/assets/js/42.50d4eaf7.js"><link rel="prefetch" href="/sys-doc/assets/js/43.8ac4c6d3.js"><link rel="prefetch" href="/sys-doc/assets/js/44.e6e0d7a1.js"><link rel="prefetch" href="/sys-doc/assets/js/45.a9a90201.js"><link rel="prefetch" href="/sys-doc/assets/js/46.a3cab201.js"><link rel="prefetch" href="/sys-doc/assets/js/47.c2690f0e.js"><link rel="prefetch" href="/sys-doc/assets/js/48.b68b2b19.js"><link rel="prefetch" href="/sys-doc/assets/js/49.cb96763b.js"><link rel="prefetch" href="/sys-doc/assets/js/5.75a3592b.js"><link rel="prefetch" href="/sys-doc/assets/js/50.68a84c7c.js"><link rel="prefetch" href="/sys-doc/assets/js/51.26054d26.js"><link rel="prefetch" href="/sys-doc/assets/js/52.8e98eb4d.js"><link rel="prefetch" href="/sys-doc/assets/js/53.354e7bd3.js"><link rel="prefetch" href="/sys-doc/assets/js/54.0f23ef6f.js"><link rel="prefetch" href="/sys-doc/assets/js/55.071e2888.js"><link rel="prefetch" href="/sys-doc/assets/js/56.78bfa98c.js"><link rel="prefetch" href="/sys-doc/assets/js/57.4a5d4ac8.js"><link rel="prefetch" href="/sys-doc/assets/js/58.76b85648.js"><link rel="prefetch" href="/sys-doc/assets/js/59.849f2544.js"><link rel="prefetch" href="/sys-doc/assets/js/6.0377ba0c.js"><link rel="prefetch" href="/sys-doc/assets/js/60.64ddd354.js"><link rel="prefetch" href="/sys-doc/assets/js/61.4ae70046.js"><link rel="prefetch" href="/sys-doc/assets/js/62.0fd68c07.js"><link rel="prefetch" href="/sys-doc/assets/js/63.f7b44d42.js"><link rel="prefetch" href="/sys-doc/assets/js/64.36ac371c.js"><link rel="prefetch" href="/sys-doc/assets/js/65.fe625daa.js"><link rel="prefetch" href="/sys-doc/assets/js/66.21f7113b.js"><link rel="prefetch" href="/sys-doc/assets/js/67.8f14156c.js"><link rel="prefetch" href="/sys-doc/assets/js/68.175f199c.js"><link rel="prefetch" href="/sys-doc/assets/js/69.d113f9d1.js"><link rel="prefetch" href="/sys-doc/assets/js/7.e59ee139.js"><link rel="prefetch" href="/sys-doc/assets/js/70.d68c84a8.js"><link rel="prefetch" href="/sys-doc/assets/js/71.4db29ca4.js"><link rel="prefetch" href="/sys-doc/assets/js/72.fd9b304b.js"><link rel="prefetch" href="/sys-doc/assets/js/73.d7ade1c6.js"><link rel="prefetch" href="/sys-doc/assets/js/74.8b6516bd.js"><link rel="prefetch" href="/sys-doc/assets/js/75.e973dd8a.js"><link rel="prefetch" href="/sys-doc/assets/js/76.76ab74b8.js"><link rel="prefetch" href="/sys-doc/assets/js/77.88181ecb.js"><link rel="prefetch" href="/sys-doc/assets/js/78.24762034.js"><link rel="prefetch" href="/sys-doc/assets/js/79.b6b8f059.js"><link rel="prefetch" href="/sys-doc/assets/js/8.9202dc84.js"><link rel="prefetch" href="/sys-doc/assets/js/80.748025a4.js"><link rel="prefetch" href="/sys-doc/assets/js/81.d74b52e6.js"><link rel="prefetch" href="/sys-doc/assets/js/82.b49b961d.js"><link rel="prefetch" href="/sys-doc/assets/js/83.ca1177e3.js"><link rel="prefetch" href="/sys-doc/assets/js/9.fde67e0a.js">
    <link rel="stylesheet" href="/sys-doc/assets/css/0.styles.f2c13968.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/sys-doc/" class="home-link router-link-active"><img src="/sys-doc/imgs/logo.jpeg" alt="sys-doc" class="logo"> <span class="site-name can-hide">sys-doc</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/sys-doc/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/sys-doc/programme/" class="nav-link router-link-active">
  编程
</a></div><div class="nav-item"><a href="/sys-doc/engineer/" class="nav-link">
  工程
</a></div><div class="nav-item"><a href="/sys-doc/framework/" class="nav-link">
  架构
</a></div><div class="nav-item"><a href="/sys-doc/shell/" class="nav-link">
  集锦
</a></div><div class="nav-item"><a href="/sys-doc/leetCode/" class="nav-link">
  LCode
</a></div> <a href="https://github.com/chttyCode/sys-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/sys-doc/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/sys-doc/programme/" class="nav-link router-link-active">
  编程
</a></div><div class="nav-item"><a href="/sys-doc/engineer/" class="nav-link">
  工程
</a></div><div class="nav-item"><a href="/sys-doc/framework/" class="nav-link">
  架构
</a></div><div class="nav-item"><a href="/sys-doc/shell/" class="nav-link">
  集锦
</a></div><div class="nav-item"><a href="/sys-doc/leetCode/" class="nav-link">
  LCode
</a></div> <a href="https://github.com/chttyCode/sys-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/sys-doc/programme/" aria-current="page" class="sidebar-link">编程</a></li><li><a href="/sys-doc/programme/git.html" class="sidebar-link">git</a></li><li><a href="/sys-doc/programme/vscode.html" class="sidebar-link">vscode</a></li><li><a href="/sys-doc/programme/typescript.html" class="sidebar-link">Typescript</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/sys-doc/programme/mini-program.html" class="sidebar-link">小程序</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>浏览器</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/sys-doc/programme/browser.html" class="sidebar-link">Browser</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>工作原理&amp;实践</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/sys-doc/programme/browser-1.html" class="sidebar-link">宏观视角下的浏览器</a></li><li><a href="/sys-doc/programme/browser-2.html" class="sidebar-link">Js 的执行机制</a></li><li><a href="/sys-doc/programme/browser-3.html" class="sidebar-link">V8 工作原理</a></li><li><a href="/sys-doc/programme/browser-4.html" class="sidebar-link">循环系统</a></li><li><a href="/sys-doc/programme/browser-5.html" class="sidebar-link">页面</a></li><li><a href="/sys-doc/programme/browser-6.html" class="sidebar-link">网络</a></li><li><a href="/sys-doc/programme/browser-7.html" aria-current="page" class="active sidebar-link">安全</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/sys-doc/programme/browser-7.html#页面安全" class="sidebar-link">页面安全</a></li><li class="sidebar-sub-header"><a href="/sys-doc/programme/browser-7.html#浏览器系统安全" class="sidebar-link">浏览器系统安全</a></li><li class="sidebar-sub-header"><a href="/sys-doc/programme/browser-7.html#网络安全" class="sidebar-link">网络安全</a></li></ul></li><li><a href="/sys-doc/programme/browser-8.html" class="sidebar-link">share browser</a></li><li><a href="/sys-doc/programme/browser-9.html" class="sidebar-link">专题</a></li></ul></section></li><li><a href="/sys-doc/programme/v8.html" class="sidebar-link">Google V8</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="安全"><a href="#安全" class="header-anchor">#</a> 安全</h1> <p>浏览器安全可以分为三大块——Web 页面安全、浏览器网络安全和浏览器系统安全</p> <h2 id="页面安全"><a href="#页面安全" class="header-anchor">#</a> 页面安全</h2> <p>Web 世界会是开放的，但我们需要隐私保护</p> <h3 id="同源策略-same-origin-policy"><a href="#同源策略-same-origin-policy" class="header-anchor">#</a> 同源策略（Same-origin policy）</h3> <p>如果两个 URL 的协议、域名和端口都相同，我们就称这两个 URL 同源</p> <p>同源策略可以隔离各个站点之间的 DOM 交互、页面数据和网络通信。主要表现在 DOM、Web 数据和网络这三个层面。</p> <h4 id="dom"><a href="#dom" class="header-anchor">#</a> DOM</h4> <p>同源策略限制了来自不同源的 JavaScript 脚本对当前 DOM 对象读和写的操作。</p> <h4 id="数据层"><a href="#数据层" class="header-anchor">#</a> 数据层</h4> <p>同源策略限制了不同源的站点读取当前站点的 Cookie、IndexDB、LocalStorage 等数据</p> <h4 id="网络"><a href="#网络" class="header-anchor">#</a> 网络</h4> <p>同源策略限制了通过 XMLHttpRequest 等方式将站点的数据发送给不同源的站点</p> <h3 id="安全和便利性的权衡"><a href="#安全和便利性的权衡" class="header-anchor">#</a> 安全和便利性的权衡</h3> <p>隔绝是安全的，但是开发又是必须的，业务中肯定会有跨站点访问的场景，浏览器安全策略中提供的平衡技术</p> <h4 id="第一步资源放开"><a href="#第一步资源放开" class="header-anchor">#</a> 第一步资源放开</h4> <p>同源策略要求页面所有资源都来自一个源，第一个平衡就是允许页面嵌入第三方资源</p> <p>带来的挑战是页面被劫持注入第三方脚本，即 xss 攻击</p> <p>浏览器的弥补策略是内容安全策略，即 CSP,其核心思想是让服务器决定浏览器能够加载哪些资源，让服务器决定浏览器是否能够执行内联 JavaScript 代码</p> <h5 id="内容安全策略-csp"><a href="#内容安全策略-csp" class="header-anchor">#</a> 内容安全策略( CSP )</h5> <p>主要目标是减少和报告 XSS 攻击</p> <p>你需要配置你的网络服务器返回 Content-Security-Policy HTTP 头部，除此之外, </p><meta> 元素也可以被用来配置该策略<p></p> <p>配置策略</p> <ol><li>default-src 限制域脚本加载</li> <li>script-src (en-US) 指令来防止内联脚本运行, 并杜绝 eval()的使用</li> <li>style-src (en-US) 指令去限制来自一个 &lt;style&gt; 元素或者 style 属性的內联样式</li> <li>img-src、media-src 限制音频或视频</li></ol> <h4 id="跨域资源共享和跨文档消息机制"><a href="#跨域资源共享和跨文档消息机制" class="header-anchor">#</a> 跨域资源共享和跨文档消息机制</h4> <p>不同站点无法进行跨站请求、无法操作 DOM，浏览器的平衡操作是提供跨域资源共享（CORS）、跨文档消息机制</p> <h5 id="跨源资源共享-cors"><a href="#跨源资源共享-cors" class="header-anchor">#</a> 跨源资源共享（CORS）</h5> <p>服务器允许跨域而来的请求，CORS 请求前会发送预检请求，该请求主要是检测目标服务器是否支持跨域访问，请求头中会有有 HTTP 方法和真实请求中会用到的头。</p> <p>出于安全性，有 HTTP 方法和真实请求中会用到的头。脚本内禁止 XMLHttpRequest 和 Fetch API 发起跨域请求</p> <h6 id="使用场景"><a href="#使用场景" class="header-anchor">#</a> 使用场景：</h6> <ol><li>由 XMLHttpRequest 或 Fetch APIs 发起的跨源 HTTP 请求。</li> <li>Web 字体 (CSS 中通过 @font-face 使用跨源字体资源)</li> <li>WebGL 贴图</li> <li>使用 drawImage 将 Images/video 画面绘制到 canvas。</li> <li>来自图像的 CSS 图形</li></ol> <h6 id="预检请求"><a href="#预检请求" class="header-anchor">#</a> 预检请求：</h6> <p>OPTIONS 方法发起一个预检请求到服务器，主要目的就是确认目标服务器是否允许跨域访问，同样服务器端也可以通知客户端，是否需要携带身份凭证（包括 Cookies 和 HTTP 认证 相关数据）需要主动设置表示标识，默认不带</p> <h6 id="带来的问题-xss-攻击-又称为-跨站脚本攻击"><a href="#带来的问题-xss-攻击-又称为-跨站脚本攻击" class="header-anchor">#</a> 带来的问题 XSS 攻击，又称为“跨站脚本攻击”</h6> <p>XSS 全称是 Cross Site Scripting，为了与“CSS”区分开来，故简称 XSS，翻译过来就是“跨站脚本”，主要表现为在 html 注入恶意脚本</p> <p>恶意脚本可做的事</p> <ol><li>可以窃取 Cookie 信息</li> <li>可以监听用户行为</li> <li>可以通过修改 DOM 伪造假的登录窗口，用来欺骗用户输入用户名和密码等信息。</li> <li>还可以在页面内生成浮窗广告，这些广告会严重地影响用户体验。</li></ol> <p>恶意脚本注入的方式</p> <ol><li>存储型 XSS 攻击
<ol><li>首先黑客利用站点漏洞将一段恶意 JavaScript 代码提交到网站的数据库中；</li> <li>然后用户向网站请求包含了恶意 JavaScript 脚本的页面；</li> <li>当用户浏览该页面的时候，恶意脚本就会将用户的 Cookie 信息等数据上传到服务器。</li></ol></li> <li>反射型 XSS 攻击
<ol><li>用户发送恶意代码</li> <li>服务器又恶意代码返回</li> <li>Web 服务器不会存储反射型 XSS 攻击的恶意脚本，这是和存储型 XSS 攻击不同的地方</li></ol></li> <li>基于 DOM 的 XSS 攻击
<ol><li>通过网络劫持、WiFi 路由器劫持的，有通过本地恶意软件来劫持的修改 dom</li> <li>就是在传输或者用户使用过程中修改 dom</li></ol></li></ol> <p>防守：</p> <ol><li>服务器对输入脚本进行过滤或转码</li></ol> <ol start="2"><li>充分利用 CSP，严格的 CSP 可以有效地防范 XSS 攻击
<ol><li>限制其他域的脚本加载，即使插入浏览器也无法加载</li> <li>禁止向第三方域提交数据，这样用户数据也不会外泄；</li> <li>禁止执行内联脚本和未授权的脚本；</li> <li>还提供了上报机制，这样可以帮助我们尽快发现有哪些 XSS 攻击，以便尽快修复问题</li></ol></li> <li>使用 HttpOnly 属性</li></ol> <h6 id="带来的-csrf-攻击-又称为-跨站请求伪造"><a href="#带来的-csrf-攻击-又称为-跨站请求伪造" class="header-anchor">#</a> 带来的 CSRF 攻击，又称为“跨站请求伪造”</h6> <p>CSRF 英文全称是 Cross-site request forgery，主要表现为黑客利用了用户的登录状态，发起跨站请求。</p> <p>攻击方式：</p> <p>前提是系统提供某一功能的接口，例如某网站提供转账接口</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//localhost:3000/sendcoin</span>
<span class="token comment">// 参数</span>
<span class="token comment">// 目标用户</span>
user<span class="token punctuation">;</span>
<span class="token comment">// 目标金额</span>
number<span class="token punctuation">;</span>
</code></pre></div><ol><li>引诱用户点击黑客页面，在黑客页面构建 get、post 的自动请求</li> <li>引诱用户点击黑客页面的相应链接，通过点击链接发起求情</li></ol> <p>与 XSS 不同的是，CSRF 攻击不需要将恶意代码注入用户的页面，仅仅是利用服务器的漏洞和用户的登录状态来实施攻击。</p> <p>分析：</p> <p>csrf 攻击的必要条件</p> <ol><li>目标站点一定要有 CSRF 漏洞，即关键点是要能找到服务器的漏洞</li> <li>用户要登录过目标站点，并且在浏览器上保持有该站点的登录状态</li> <li>需要用户打开一个第三方站点，可以是黑客的站点</li></ol> <p>与 XSS 攻击不同，CSRF 攻击不会往页面注入恶意脚本，因此黑客是无法通过 CSRF 攻击来获取用户页面数据的</p> <p>防守：</p> <ol><li><p>充分利用好 Cookie 的 SameSite 属性
就是要同源站点携带 cookie，非同源站点禁止携带,Cookie 中的 SameSite 属性正是为了解决这个问题的
SameSites 属性值：</p> <ol><li>Strict 最为严格，完全禁止非同源 cookie 携带</li> <li>Lax 相对宽松一点，Get ，链接打开、get 表单会携带 Cookie，img、iframe 等标签加载的 URL，这些场景都不会携带 Cookie</li> <li>None，在任何情况下都会发送 Cookie 数据</li></ol></li> <li><p>验证请求的来源站点
就是服务器端通过 HTTP 请求头中的 Referer 和 Origin 属性验证请求来源的站点</p> <ol><li>Referer 是 HTTP 请求头中的一个字段，记录了该 HTTP 请求的来源地址，，但是有一些场景是不适合将来源 URL 暴露给服务器的</li> <li>Origin 属性只包含了域名信息，并没有包含具体的 URL 路径，</li></ol> <p>服务器的策略是优先判断 Origin，如果请求头中没有包含 Origin 属性，再根据实际情况判断是否使用 Referer 值</p></li> <li><p>CSRF Token</p> <ol><li>在浏览器向服务器发起请求时，服务器生成一个 CSRF Token，然后将该字符串植入到返回的页面中</li> <li>在浏览器端如果要发起转账的请求，那么需要带上页面中的 CSRF Token，然后服务器会验证该 Token 是否合法。</li></ol></li></ol> <h5 id="跨文档消息机制-window-postmessage"><a href="#跨文档消息机制-window-postmessage" class="header-anchor">#</a> 跨文档消息机制(window.postMessage)</h5> <p>适用于两个页面的端口、协议、 Document.domain 相同的安全通信</p> <h2 id="浏览器系统安全"><a href="#浏览器系统安全" class="header-anchor">#</a> 浏览器系统安全</h2> <p>浏览器安全问题，我们没有什么可操作的，但还是需要知道浏览器在这方面做了那些优化</p> <p>首先浏览器漏洞是核弹级别的，因为通过浏览器漏洞可以入侵浏览器进程内部的、可以读取和修改浏览器进程内部的任意内容，还可以穿透浏览器，在用户的操作系统上悄悄地安装恶意软件、监听用户键盘输入信息以及读取用户硬盘上的文件内容</p> <h3 id="安全沙箱"><a href="#安全沙箱" class="header-anchor">#</a> 安全沙箱</h3> <p>利用系统提供的安全技术，将渲染进程和浏览器内和操作系统隔离</p> <p>浏览器可以下载任意类型的文件，即使有恶意程序只要不执行就不会生效。但是渲染进行需要对这些网络下载内容进行处理就有可能执行到恶意程序，对系统漏洞发起攻击，基于此我们需要对渲染进程创建隔离沙箱</p> <h4 id="安全沙箱对渲染进程存在一些调整"><a href="#安全沙箱对渲染进程存在一些调整" class="header-anchor">#</a> 安全沙箱对渲染进程存在一些调整</h4> <ol><li>持久存储，cookie、storage 网络进程的缓存文件都需要在浏览器进程完成</li> <li>网络访问，渲染进程不能直接发起网络请求，需要交由浏览器进行来处理，此刻也会检测是否有跨域，资源混用</li> <li>用户交互，渲染进程无法直接访问窗口句柄、即无法直接监听用户输入、渲染页面，这些都交由浏览器进程来处理通过 IPC 同步消息</li></ol> <h4 id="站点隔离"><a href="#站点隔离" class="header-anchor">#</a> 站点隔离</h4> <p>将根域名和协议相同的站点放到同一渲染进程中</p> <h2 id="网络安全"><a href="#网络安全" class="header-anchor">#</a> 网络安全</h2> <p>起初 http 就是为了简单的文本传输，没有太强的加密需求，所以一直保持着明文传输</p> <h3 id="存在的问题"><a href="#存在的问题" class="header-anchor">#</a> 存在的问题</h3> <p>HTTP 传输的内容很容易被中间人窃取、伪造和篡改，通常我们把这种攻击方式称为中间人攻击，数据会经过用户电脑、WiFi 路由器、运营商和目标服务器，很可能被恶意软件、钓鱼 wifi 抓取篡改</p> <h3 id="解决方案"><a href="#解决方案" class="header-anchor">#</a> 解决方案：</h3> <p>在 HTTP 协议栈中引入安全层</p> <p>主要目的：对发起 HTTP 请求的数据进行加密操作和对接收到 HTTP 的内容进行解密操作</p> <h3 id="实践"><a href="#实践" class="header-anchor">#</a> 实践</h3> <h4 id="第一版-使用对称加密"><a href="#第一版-使用对称加密" class="header-anchor">#</a> 第一版：使用对称加密</h4> <p>对称加密即指服务端和客户端的使用的是相同的加密算法和密钥</p> <p>解决方案：</p> <ol><li>客户端发送加密套件、client-radom</li> <li>服务端接受加密消息，选择并返回加密算法、service-radom</li> <li>客户端要返回确认消息</li> <li>服务端接到客户端的确认消息也会返回确认消息</li></ol> <p>解决了明文传输的问题，服务器客户端采用加解密的方式进行通信</p> <p>存在的问题</p> <ol><li>加密协商的过程还是以明文的方式进行</li></ol> <p><img src="/sys-doc/imgs/https1.0.png" alt="alt https1.0"></p> <h4 id="第二版-使用非对称加密"><a href="#第二版-使用非对称加密" class="header-anchor">#</a> 第二版：使用非对称加密</h4> <p>非对称就是指原先对称的时候双方都可加解密，现在只有客户端加密、服务端解密所以就叫非对称</p> <p>解决方案：</p> <ol><li>客户端发送非对称加密套件</li> <li>服务端接受消息并返回非对称加密算法、公钥</li> <li>客户端回复确认消息</li> <li>服务端回复确认消息</li></ol> <p>客户端使用非对称加密算法和公钥对消息进行加密</p> <p>解决了对称加密加密算法、密钥明文传输的问题</p> <p>存在的问题</p> <ol><li>非对称加密较对称加密更耗时</li></ol> <p><img src="/sys-doc/imgs/https2.0.png" alt="alt https2.0"></p> <h4 id="第三版-对称加密和非对称加密搭配使用"><a href="#第三版-对称加密和非对称加密搭配使用" class="header-anchor">#</a> 第三版：对称加密和非对称加密搭配使用</h4> <p>如果全流程对每个请求都采用非对称加密那将影响用户体验</p> <p>解决方案</p> <ol><li>客户端发送对称、非对称加密套件、client-radom</li> <li>服务端返回对称、非对称加密算法、service-radom、公钥</li> <li>客户端在生成一个 pre-master radom,使用公钥加密发送至服务端</li> <li>服务端回复确认消息</li></ol> <p>服务端客户端采用对称加密、使用 client-radom、service-radom、pre-master 作为新的密钥进行加密通信</p> <p>解决了对称加密使用明传输密钥、非对称加密耗时的问题</p> <p>存在的问题：</p> <ol><li>如果发生域名劫持等事件，浏览器无法确认跟自己通信的服务器是不是真实的</li></ol> <p><img src="/sys-doc/imgs/https3.0.png" alt="alt https3.0"></p> <h4 id="第四版-添加数字证书"><a href="#第四版-添加数字证书" class="header-anchor">#</a> 第四版：添加数字证书</h4> <p>就是在协商加密的过程中首先确认对方的身份</p> <p>解决方案</p> <ol><li>服务端返回对称、非对称加密算法、service-radom、数字证书（CA 机构证书）</li></ol> <p>数字证书内会包含公钥</p> <h5 id="数字证书申请"><a href="#数字证书申请" class="header-anchor">#</a> 数字证书申请</h5> <ol><li>首先需要准备一套私钥和公钥，私钥留着自己使用</li> <li>然后向 CA 机构提交公钥、公司、站点等信息并等待认证，这个认证过程可能是收费的</li> <li>CA 进行核实</li> <li>审核通过，CA 会发认证的数字证书</li></ol> <p><img src="/sys-doc/imgs/ca.png" alt="alt ca"></p> <h5 id="数字证书验证"><a href="#数字证书验证" class="header-anchor">#</a> 数字证书验证</h5> <p>浏览器需要验证证书的有效期、证书是否被 CA 吊销、证书是否是合法的 CA 机构颁发的</p> <p>验证过程</p> <ol><li>验证证书的有效期</li> <li>验证数字证书是否被吊销了，一种是下载吊销证书列表，第二种是在线验证方式</li> <li>证极数字证书是否是 CA 机构颁发的
<ol><li>首先，浏览器利用证书的原始信息计算出信息摘要</li> <li>然后，利用 CA 的公钥来解密数字证书中的数字签名，解密出来的数据也是信息摘要</li> <li>最后，判断这两个信息摘要是否相等就可以了</li></ol></li></ol> <p>存在的问题</p> <ol><li><p>CA 公钥的怎么获取</p> <ol><li>当你部署 HTTP 服务器的时候，除了部署当前的数字证书之外，还需要部署 CA 机构的数字证书，CA 机构的数字证书包括了 CA 的公钥，以及 CA 机构的一些基础信息。</li> <li>加密协商的时候发生给浏览器</li></ol> <p>如果服务器没有部署 CA 机构的证书，浏览器也会自己下载不过会耗时</p> <p>存在的问题：CA 机构不合法怎么办</p></li> <li><p>CA 机构的合法性证明</p> <p>并没有一个非常好的方法来证明 CA 的合法性，妥协的方案是，直接在操作系统中内置这些 CA 机构的数字证书</p> <p>但 CA 机构众多，因此操作系统不可能将每家 CA 的数字证书都内置进操作系统。</p> <p>解决方案：</p> <p>数字证书链：将颁发证书的机构划分为两种类型，根 CA(Root CAs)和中间 CA(Intermediates CAs)</p> <p>浏览器会验证当前 CA 的合法性、如果发现该 CA 是中间 CA 会继续验证这个中间 CA 的根证书，直到根 CA</p> <p>最后的根 CA 就是简单地判断这个根证书在不在操作系统里面，在即合法、不在即非法</p> <p>首先根 CA 一般都会内置在各大操作系统内，而根 CA 的认证是要通过 WebTrust 国际安全审计的</p></li></ol> <p><img src="/sys-doc/imgs/https4.0.png" alt="alt https4.0"></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/chttyCode/sys-doc/edit/master/docs/programme/browser-7.md" target="_blank" rel="noopener noreferrer">编辑此内容</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/05/31</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/sys-doc/programme/browser-6.html" class="prev">
        网络
      </a></span> <span class="next"><a href="/sys-doc/programme/browser-8.html">
        share browser
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/sys-doc/assets/js/app.4dbaeb20.js" defer></script><script src="/sys-doc/assets/js/2.01d9652a.js" defer></script><script src="/sys-doc/assets/js/39.6d8c0228.js" defer></script>
  </body>
</html>
