# 循环系统

- 页面循环系统
  - 渲染进程的主线程
    - 主线程非常繁忙，既要处理 DOM，又要计算样式，还要处理布局，同时还需要处理 JavaScript 任务以及各种输入事件
    - 存在的问题
      - 单一主线程只能处理预安排的任务
      - 如何处理过程中的任务
  - 事件+循环
    - 循环
      - 在线程语句最后添加了一个 for 循环语句，线程会一直循环执行
    - 事件
      - 线程运行过程中可以监听用户行为等事件，激活循环处理任务
    - 存在的问题
      - 这种监听+循环处理只能处理自身执行过程中产生的任务，如何处理其他线程、进程的问题
  - 队列
    - 事件+循环只能执行自身执行过程中产生的任务,需要实现一个收集任务的数据结构，而这个结构满足先进显然是队列这种数据结构的特点
    - 所以无论是线程、进程还是执行过程中产生的任务都加入到任务队列中，待主线程循环执行
- setTimeout
  - 如何去执行一个指定时间触发的任务
  - 在已有的任务队列是满足不了需求的，所以设计一个新的队列，该队列同样满足先进先出，只是队列存储的是一个 MAP 类型的任务，该 map 对象有时间信息，用于判断是否执行该任务
  - 踩坑指南
    - tab 不是激活状态时，setTimeout 的执行时间是 1000ms
    - 嵌套达到 5 层的定时器，会被浏览器认定为存在性能问题，其执行的时间间隔>=4ms，动画慎用
    - 时间间隔不能大于，否则会是立即执行的效果
- XMLRequest
  - 踩坑指南
    - 存在跨域问题
    - 资源混合
- 微任务与宏任务
  - 监听 dom 变化
    - 第一版
      - 实时回调
      - 存在性能问题
    - 第二版
      - 批量回调
      - 存在操作 dom 实时性问题
    - 第三版
      - 在宏任务队列之外在维护一个队列，即微任务队列
      - 每一个宏任务都会维护一个微任务队列，在宏任务执行完推出时会检测执行微任务队列
      - 即保证了实时性、又解决了性能问题
- promise
  - 避免回调地狱
- async/await
  - 写同步代码
  - genrator
