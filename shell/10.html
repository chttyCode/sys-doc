<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>10 月 | sys-doc</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/sys-doc/assets/css/0.styles.f2c13968.css" as="style"><link rel="preload" href="/sys-doc/assets/js/app.0aa4aa39.js" as="script"><link rel="preload" href="/sys-doc/assets/js/2.01d9652a.js" as="script"><link rel="preload" href="/sys-doc/assets/js/90.95f934a7.js" as="script"><link rel="prefetch" href="/sys-doc/assets/js/10.331427a7.js"><link rel="prefetch" href="/sys-doc/assets/js/11.89b28dfb.js"><link rel="prefetch" href="/sys-doc/assets/js/12.7136e253.js"><link rel="prefetch" href="/sys-doc/assets/js/13.a1feb60a.js"><link rel="prefetch" href="/sys-doc/assets/js/14.b0c7cf4d.js"><link rel="prefetch" href="/sys-doc/assets/js/15.28671588.js"><link rel="prefetch" href="/sys-doc/assets/js/16.edc12257.js"><link rel="prefetch" href="/sys-doc/assets/js/17.13d64156.js"><link rel="prefetch" href="/sys-doc/assets/js/18.61d35156.js"><link rel="prefetch" href="/sys-doc/assets/js/19.05bd98c3.js"><link rel="prefetch" href="/sys-doc/assets/js/20.a0cf136a.js"><link rel="prefetch" href="/sys-doc/assets/js/21.03ded64d.js"><link rel="prefetch" href="/sys-doc/assets/js/22.48cb9c16.js"><link rel="prefetch" href="/sys-doc/assets/js/23.0c180cf1.js"><link rel="prefetch" href="/sys-doc/assets/js/24.77e09a3e.js"><link rel="prefetch" href="/sys-doc/assets/js/25.e55672d9.js"><link rel="prefetch" href="/sys-doc/assets/js/26.e11de8a1.js"><link rel="prefetch" href="/sys-doc/assets/js/27.e81e4d27.js"><link rel="prefetch" href="/sys-doc/assets/js/28.86516cc2.js"><link rel="prefetch" href="/sys-doc/assets/js/29.2495c241.js"><link rel="prefetch" href="/sys-doc/assets/js/3.64871857.js"><link rel="prefetch" href="/sys-doc/assets/js/30.18bddb07.js"><link rel="prefetch" href="/sys-doc/assets/js/31.746e69a7.js"><link rel="prefetch" href="/sys-doc/assets/js/32.8ea986b7.js"><link rel="prefetch" href="/sys-doc/assets/js/33.2a1b84a9.js"><link rel="prefetch" href="/sys-doc/assets/js/34.a36061ee.js"><link rel="prefetch" href="/sys-doc/assets/js/35.2ae43d7a.js"><link rel="prefetch" href="/sys-doc/assets/js/36.d2c1b8f0.js"><link rel="prefetch" href="/sys-doc/assets/js/37.cc8083e8.js"><link rel="prefetch" href="/sys-doc/assets/js/38.18d5c3fb.js"><link rel="prefetch" href="/sys-doc/assets/js/39.400134f5.js"><link rel="prefetch" href="/sys-doc/assets/js/4.ba3164ba.js"><link rel="prefetch" href="/sys-doc/assets/js/40.13cfc96b.js"><link rel="prefetch" href="/sys-doc/assets/js/41.ac2831e2.js"><link rel="prefetch" href="/sys-doc/assets/js/42.55484600.js"><link rel="prefetch" href="/sys-doc/assets/js/43.4d27d512.js"><link rel="prefetch" href="/sys-doc/assets/js/44.ad97250e.js"><link rel="prefetch" href="/sys-doc/assets/js/45.6065fa8c.js"><link rel="prefetch" href="/sys-doc/assets/js/46.4413432f.js"><link rel="prefetch" href="/sys-doc/assets/js/47.0d79612e.js"><link rel="prefetch" href="/sys-doc/assets/js/48.d274b5d4.js"><link rel="prefetch" href="/sys-doc/assets/js/49.f8439c54.js"><link rel="prefetch" href="/sys-doc/assets/js/5.75a3592b.js"><link rel="prefetch" href="/sys-doc/assets/js/50.40551dde.js"><link rel="prefetch" href="/sys-doc/assets/js/51.e12b1765.js"><link rel="prefetch" href="/sys-doc/assets/js/52.cc20c010.js"><link rel="prefetch" href="/sys-doc/assets/js/53.a3510f58.js"><link rel="prefetch" href="/sys-doc/assets/js/54.7ebec001.js"><link rel="prefetch" href="/sys-doc/assets/js/55.cb79291a.js"><link rel="prefetch" href="/sys-doc/assets/js/56.ca7ffcc9.js"><link rel="prefetch" href="/sys-doc/assets/js/57.61256422.js"><link rel="prefetch" href="/sys-doc/assets/js/58.7ebe3dfb.js"><link rel="prefetch" href="/sys-doc/assets/js/59.b034b25d.js"><link rel="prefetch" href="/sys-doc/assets/js/6.0377ba0c.js"><link rel="prefetch" href="/sys-doc/assets/js/60.4d62833a.js"><link rel="prefetch" href="/sys-doc/assets/js/61.4859c619.js"><link rel="prefetch" href="/sys-doc/assets/js/62.ce214bc4.js"><link rel="prefetch" href="/sys-doc/assets/js/63.77c4ccf6.js"><link rel="prefetch" href="/sys-doc/assets/js/64.ae6ff0e5.js"><link rel="prefetch" href="/sys-doc/assets/js/65.58427e2c.js"><link rel="prefetch" href="/sys-doc/assets/js/66.c04338e0.js"><link rel="prefetch" href="/sys-doc/assets/js/67.4a99f3ad.js"><link rel="prefetch" href="/sys-doc/assets/js/68.1cc92697.js"><link rel="prefetch" href="/sys-doc/assets/js/69.4d3efa88.js"><link rel="prefetch" href="/sys-doc/assets/js/7.e59ee139.js"><link rel="prefetch" href="/sys-doc/assets/js/70.87bf553e.js"><link rel="prefetch" href="/sys-doc/assets/js/71.0e75f328.js"><link rel="prefetch" href="/sys-doc/assets/js/72.8f9cc41d.js"><link rel="prefetch" href="/sys-doc/assets/js/73.189ed926.js"><link rel="prefetch" href="/sys-doc/assets/js/74.b04eeb73.js"><link rel="prefetch" href="/sys-doc/assets/js/75.bf6437b6.js"><link rel="prefetch" href="/sys-doc/assets/js/76.fc01e844.js"><link rel="prefetch" href="/sys-doc/assets/js/77.4fc037bd.js"><link rel="prefetch" href="/sys-doc/assets/js/78.399055fb.js"><link rel="prefetch" href="/sys-doc/assets/js/79.3b969b1d.js"><link rel="prefetch" href="/sys-doc/assets/js/8.9202dc84.js"><link rel="prefetch" href="/sys-doc/assets/js/80.668a96a7.js"><link rel="prefetch" href="/sys-doc/assets/js/81.631599d8.js"><link rel="prefetch" href="/sys-doc/assets/js/82.6140ebbf.js"><link rel="prefetch" href="/sys-doc/assets/js/83.8b011cc1.js"><link rel="prefetch" href="/sys-doc/assets/js/84.acf9b35c.js"><link rel="prefetch" href="/sys-doc/assets/js/85.2da86151.js"><link rel="prefetch" href="/sys-doc/assets/js/86.08bc7e9e.js"><link rel="prefetch" href="/sys-doc/assets/js/87.e5588c9d.js"><link rel="prefetch" href="/sys-doc/assets/js/88.921758e0.js"><link rel="prefetch" href="/sys-doc/assets/js/89.38f7f9a1.js"><link rel="prefetch" href="/sys-doc/assets/js/9.fde67e0a.js"><link rel="prefetch" href="/sys-doc/assets/js/91.a11be71c.js"><link rel="prefetch" href="/sys-doc/assets/js/92.adee5313.js"><link rel="prefetch" href="/sys-doc/assets/js/93.05bfd7e3.js"><link rel="prefetch" href="/sys-doc/assets/js/94.9a7f321a.js">
    <link rel="stylesheet" href="/sys-doc/assets/css/0.styles.f2c13968.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/sys-doc/" class="home-link router-link-active"><img src="/sys-doc/imgs/logo.jpeg" alt="sys-doc" class="logo"> <span class="site-name can-hide">sys-doc</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/sys-doc/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/sys-doc/programme/" class="nav-link">
  编程
</a></div><div class="nav-item"><a href="/sys-doc/engineer/" class="nav-link">
  工程
</a></div><div class="nav-item"><a href="/sys-doc/framework/" class="nav-link">
  架构
</a></div><div class="nav-item"><a href="/sys-doc/shell/" class="nav-link router-link-active">
  集锦
</a></div><div class="nav-item"><a href="/sys-doc/leetCode/" class="nav-link">
  LCode
</a></div> <a href="https://github.com/chttyCode/sys-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/sys-doc/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/sys-doc/programme/" class="nav-link">
  编程
</a></div><div class="nav-item"><a href="/sys-doc/engineer/" class="nav-link">
  工程
</a></div><div class="nav-item"><a href="/sys-doc/framework/" class="nav-link">
  架构
</a></div><div class="nav-item"><a href="/sys-doc/shell/" class="nav-link router-link-active">
  集锦
</a></div><div class="nav-item"><a href="/sys-doc/leetCode/" class="nav-link">
  LCode
</a></div> <a href="https://github.com/chttyCode/sys-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/sys-doc/shell/" aria-current="page" class="sidebar-link">目录</a></li><li><a href="/sys-doc/shell/collection.html" class="sidebar-link">墨迹</a></li><li><a href="/sys-doc/shell/01.html" class="sidebar-link">1月</a></li><li><a href="/sys-doc/shell/02.html" class="sidebar-link">2月</a></li><li><a href="/sys-doc/shell/03.html" class="sidebar-link">3月</a></li><li><a href="/sys-doc/shell/04.html" class="sidebar-link">4月</a></li><li><a href="/sys-doc/shell/05.html" class="sidebar-link">5月</a></li><li><a href="/sys-doc/shell/06.html" class="sidebar-link">6月</a></li><li><a href="/sys-doc/shell/07.html" class="sidebar-link">7月</a></li><li><a href="/sys-doc/shell/08.html" class="sidebar-link">8月</a></li><li><a href="/sys-doc/shell/09.html" class="sidebar-link">9月</a></li><li><a href="/sys-doc/shell/10.html" aria-current="page" class="active sidebar-link">10月</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/sys-doc/shell/10.html#架构学习" class="sidebar-link">架构学习</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/sys-doc/shell/10.html#需求分析-架构设计" class="sidebar-link">需求分析&amp;架构设计</a></li><li class="sidebar-sub-header"><a href="/sys-doc/shell/10.html#需求设计" class="sidebar-link">需求设计</a></li><li class="sidebar-sub-header"><a href="/sys-doc/shell/10.html#开发流程" class="sidebar-link">开发流程</a></li></ul></li><li class="sidebar-sub-header"><a href="/sys-doc/shell/10.html#需求规划" class="sidebar-link">需求规划</a></li><li class="sidebar-sub-header"><a href="/sys-doc/shell/10.html#核心概念" class="sidebar-link">核心概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/sys-doc/shell/10.html#the-manifest" class="sidebar-link">The manifest</a></li><li class="sidebar-sub-header"><a href="/sys-doc/shell/10.html#the-service-worker" class="sidebar-link">The service worker</a></li><li class="sidebar-sub-header"><a href="/sys-doc/shell/10.html#content-scripts" class="sidebar-link">Content scripts</a></li><li class="sidebar-sub-header"><a href="/sys-doc/shell/10.html#the-popup-and-other-pages" class="sidebar-link">The popup and other pages</a></li></ul></li><li class="sidebar-sub-header"><a href="/sys-doc/shell/10.html#功能开发" class="sidebar-link">功能开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/sys-doc/shell/10.html#通用配置" class="sidebar-link">通用配置</a></li><li class="sidebar-sub-header"><a href="/sys-doc/shell/10.html#pop-页面开发" class="sidebar-link">pop 页面开发</a></li><li class="sidebar-sub-header"><a href="/sys-doc/shell/10.html#脚本注入" class="sidebar-link">脚本注入</a></li><li class="sidebar-sub-header"><a href="/sys-doc/shell/10.html#newtab" class="sidebar-link">newTab</a></li></ul></li><li class="sidebar-sub-header"><a href="/sys-doc/shell/10.html#发布上线" class="sidebar-link">发布上线</a></li><li class="sidebar-sub-header"><a href="/sys-doc/shell/10.html#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/sys-doc/shell/11.html" class="sidebar-link">11月</a></li><li><a href="/sys-doc/shell/12.html" class="sidebar-link">12月</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_10-月"><a href="#_10-月" class="header-anchor">#</a> 10 月</h1> <h2 id="架构学习"><a href="#架构学习" class="header-anchor">#</a> 架构学习</h2> <blockquote><p>通过技术手段实现业务的增长,技术永远都是为业务服务的，技术是实现业务增长的工具</p></blockquote> <ul><li><p>架构思维</p></li> <li><p>浅层学习看输入 深层学习看输出</p></li> <li><p>凡事都是机遇+能力</p></li></ul> <h3 id="需求分析-架构设计"><a href="#需求分析-架构设计" class="header-anchor">#</a> 需求分析&amp;架构设计</h3> <ul><li>架构思维分析
<ul><li>全局思维</li> <li>整体思维</li> <li>闭环思维</li></ul></li> <li>方案设计文档</li> <li>数据结构设计：核心问题</li></ul> <h4 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h4> <ul><li>不要关注细节、要看整体、看范围</li> <li>设计要考虑复杂度、越简单越好、不要过度设计、不要为了设计而设计，不要为了秀技术</li></ul> <h3 id="需求设计"><a href="#需求设计" class="header-anchor">#</a> 需求设计</h3> <p>脱离业务的架构都是耍流氓，架构师必须要深入理解业务</p> <p>eg: 架构师的思维来分析需求</p> <h3 id="开发流程"><a href="#开发流程" class="header-anchor">#</a> 开发流程</h3> <p>启动</p> <h4 id="浅层需求"><a href="#浅层需求" class="header-anchor">#</a> 浅层需求</h4> <ul><li>知识库</li> <li>登陆、创建、编辑、发布</li></ul> <h4 id="深层需求"><a href="#深层需求" class="header-anchor">#</a> 深层需求</h4> <p>不容易看出，却很重要的</p> <ul><li><p>作品管理</p> <ul><li>删除、回复</li> <li>专赠</li> <li>复制</li></ul></li> <li><p>作品统计
需求闭环</p> <ul><li>统计</li> <li>分渠道统计</li></ul></li> <li><p>作品发布</p> <ul><li>url 不能变，广告位不能改的场景</li> <li>支持多渠道</li></ul></li> <li><p>H5 分享</p> <p>负责业务增长</p></li> <li><p>后台管理</p> <ul><li>数据统计：注册人员、等</li> <li>作品管理：能快速上下线、防止违规内容</li> <li>用户管理：能快速冻结用户、防止违规用户</li> <li>模版管理：展示标签</li></ul></li></ul> <h4 id="注意事项-2"><a href="#注意事项-2" class="header-anchor">#</a> 注意事项</h4> <ul><li>不要一心想着写代码</li></ul> <h1 id="chrome-插件"><a href="#chrome-插件" class="header-anchor">#</a> chrome 插件</h1> <h2 id="需求规划"><a href="#需求规划" class="header-anchor">#</a> 需求规划</h2> <p>日常开发 chrome 打开使用的频率都比较高，想做个 tab 页面</p> <p>页面功能：</p> <ol><li>日历</li> <li>任务规划</li> <li>爬取感兴趣的咨询</li></ol> <p>这也算是给这篇文章定一个基调，本文主要用于记录开发过程以及遇到的坑</p> <h2 id="核心概念"><a href="#核心概念" class="header-anchor">#</a> 核心概念</h2> <h3 id="the-manifest"><a href="#the-manifest" class="header-anchor">#</a> The manifest</h3> <p>manifest.json 它还必须位于扩展的根目录中。清单记录重要的元数据、定义资源、声明权限并标识要在后台和页面上运行的文件。</p> <h3 id="the-service-worker"><a href="#the-service-worker" class="header-anchor">#</a> The service worker</h3> <p>service_worker 可以处理和侦听浏览器事件。有许多类型的事件，例如导航到新页面、删除书签或关闭选项卡。可以使用<a href="https://developer.chrome.com/docs/extensions/reference/" target="_blank" rel="noopener noreferrer">Chrome APIs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>但不能直接与页面交互，只能采用通信的方式与 Content scripts 关联</p> <div class="language-json extra-class"><pre class="language-json"><code> <span class="token property">&quot;background&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;service_worker&quot;</span><span class="token operator">:</span> <span class="token string">&quot;background.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="content-scripts"><a href="#content-scripts" class="header-anchor">#</a> Content scripts</h3> <p>就是通过 chrome 插件机制在当前页面注入的一段脚本，共享当前页面原始 DOM 但不共享 JS，同时无法获取使用 <a href="https://developer.chrome.com/docs/extensions/reference/" target="_blank" rel="noopener noreferrer">Chrome APIs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>,但有 4 个 api 除外</p> <ol><li>chrome.extension(getURL , inIncognitoContext , lastError , onRequest , sendRequest)</li> <li>chrome.i18n</li> <li>chrome.runtime(connect , getManifest , getURL , id , onConnect , onMessage , sendMessage)</li> <li>chrome.storage</li></ol> <p>以上 API 基本够用，如果不够用可以通过通信的方式与 service worker 关联</p> <h3 id="the-popup-and-other-pages"><a href="#the-popup-and-other-pages" class="header-anchor">#</a> The popup and other pages</h3> <p>插件可以设置不同的页面，eg:popup 、options</p> <p>这些页面可以访问所有的<a href="https://developer.chrome.com/docs/extensions/reference/" target="_blank" rel="noopener noreferrer">Chrome APIs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="功能开发"><a href="#功能开发" class="header-anchor">#</a> 功能开发</h2> <h3 id="通用配置"><a href="#通用配置" class="header-anchor">#</a> 通用配置</h3> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chtty&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.0.1&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;All schedule information&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;manifest_version&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token property">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;storage&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;activeTab&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;scripting&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;contextMenus&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;notifications&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;webRequest&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>

  <span class="token property">&quot;background&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;service_worker&quot;</span><span class="token operator">:</span> <span class="token string">&quot;background.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>manifest_version 配置文件的版本，也是必填字段，v2 版本即将下线，当前版本 v3,不同的版本可以使用的插件能力也不同。v3 在 v2 版本上增强了安全性、隐私性和性能,同时新增了 service workers and promises<a href="https://developer.chrome.com/docs/extensions/mv3/intro/mv3-overview/" target="_blank" rel="noopener noreferrer">v3 新特性<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>;</p> <p>permissions 权限设置,<a href="https://developer.chrome.com/docs/extensions/mv2/declare_permissions/" target="_blank" rel="noopener noreferrer">权限列表<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>background 后台服务脚本，v2 版本这个后台服务脚本是一个常驻脚本，生命周期就是浏览器打开到浏览器关闭，一直在后台运行，v3 版本改为了按需执行，这是一个改动比较大的地方</p> <p>eg:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onMessage<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  count<span class="token operator">++</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这段代码在 v2 版本是 ok 的，可以正常读写 count,在 v3 就不能这使用了,需要借助 storage 的能力，不然无法读取 count</p> <div class="language-js extra-class"><pre class="language-js"><code>chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onMessage<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  chrome<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>local<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> result<span class="token punctuation">.</span>count <span class="token operator">?</span> result<span class="token punctuation">.</span>count<span class="token operator">++</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
    chrome<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>local<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="pop-页面开发"><a href="#pop-页面开发" class="header-anchor">#</a> pop 页面开发</h3> <p>点击浏览器插件 icon 时的弹窗页面，v3 版本在 action 字段中进行设置。之所以强调是 v3 版本，是因为在 v2 版本中是以 browser_action &amp; page_action 配置体现的。配置的 html 可以正常引入 JS、CSS 资源，JS 中涉及的 chrome APi 权限的要在 permissions 申请。</p> <div class="language-json extra-class"><pre class="language-json"><code>  <span class="token property">&quot;action&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;default_popup&quot;</span><span class="token operator">:</span> <span class="token string">&quot;popup.html&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;default_icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;img/icon.png&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;default_title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;这是一个示例Chrome插件&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>配置项有 icon、title、pop，其中有个 badge，即图标上的文本，无法通过配置项设置生效，需要通过脚本手执行添加</p> <div class="language-js extra-class"><pre class="language-js"><code>chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span><span class="token function">setBadgeText</span><span class="token punctuation">(</span><span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">&quot;kds&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//TODO action 替代了 browserAction</span>
chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span><span class="token function">setBadgeBackgroundColor</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>因为 browser_action &amp; page_action 合并到 action ,所以 chrome 提供的 api 也由以前的 browserAction 改到了 action</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// v2版本 api 使用方式</span>
chrome<span class="token punctuation">.</span>browserAction<span class="token punctuation">.</span><span class="token function">setBadgeText</span><span class="token punctuation">(</span><span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">&quot;new&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
chrome<span class="token punctuation">.</span>browserAction<span class="token punctuation">.</span><span class="token function">setBadgeBackgroundColor</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="脚本注入"><a href="#脚本注入" class="header-anchor">#</a> 脚本注入</h3> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;host_permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://*/*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;content_scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// &quot;&lt;all_urls&gt;&quot; 表示匹配所有地址</span>
      <span class="token property">&quot;matches&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;all_urls&gt;&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// 多个JS按顺序注入</span>
      <span class="token property">&quot;js&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;content-script.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// JS的注入可以随便一点，但是CSS的注意就要千万小心了，因为一不小心就可能影响全局样式</span>
      <span class="token property">&quot;css&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;content-css.css&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// 代码注入的时间，可选值： &quot;document_start&quot;, &quot;document_end&quot;, or &quot;document_idle&quot;，最后一个表示页面空闲时，默认document_idle</span>
      <span class="token property">&quot;run_at&quot;</span><span class="token operator">:</span> <span class="token string">&quot;document_end&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>需要申请 host 权限，插件脚本想要插入当前页面必须申请当前页面 host 权限，该字段支持接收一个数组参数，还支持正则</p> <p>配置注册的脚本是有缺陷的，无法共享 JS,解决方案就是手动在当前页面插入一段脚本</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">injectCustomJs</span><span class="token punctuation">(</span><span class="token parameter">jsPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  jsPath <span class="token operator">=</span> jsPath <span class="token operator">||</span> <span class="token string">&quot;inject-script.js&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> temp <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  temp<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/javascript&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 获得的地址类似：chrome-extension://ihcokhadfjfchaeagdoclpnjdiokfakg/js/inject.js</span>
  temp<span class="token punctuation">.</span>src <span class="token operator">=</span> chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">getURL</span><span class="token punctuation">(</span>jsPath<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TODO  chrome.extension.getURL</span>

  temp<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 放在页面不好看，执行完后移除掉</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">(</span>document<span class="token punctuation">.</span>head <span class="token operator">||</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TODO document.head</span>
<span class="token punctuation">}</span>
</code></pre></div><p>因为版本变迁 chrome api 有所改变，getURL 从 runtime 上获取，extension 对象已不存在，还有一个 document 的坑,无法获取 head
此时通过 content script 脚本向页面添加动态脚本，可是普通页面访问不了插件的资源，此刻还需要增加一项配置。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;web_accessible_resources&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;resources&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;inject-script.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;matches&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;all_urls&gt;&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这个字段在 v2 接受一个数组，在 v3 接受的是一个对象</p> <h3 id="newtab"><a href="#newtab" class="header-anchor">#</a> newTab</h3> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;chrome_url_overrides&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;newtab&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./build/index.html&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>newTab 采用的是 React cli 搭建的页面，对 build 生成的静态资源引用路径要改为相对路径</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;homepage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;.&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="发布上线"><a href="#发布上线" class="header-anchor">#</a> 发布上线</h2> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <p><a href="https://doc.yilijishu.info/chrome/" target="_blank" rel="noopener noreferrer">Chrome 扩展 V3 中文文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://blog.shahednasser.com/chrome-extension-tutorial-migrating-to-manifest-v3-from-v2/#from-background-scripts-to-service-workers" target="_blank" rel="noopener noreferrer">v2 迁移到 v3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://cloud.tencent.com/developer/article/1667242" target="_blank" rel="noopener noreferrer">【干货】Chrome 插件(扩展)开发全攻略<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/chttyCode/sys-doc/edit/master/docs/shell/10.md" target="_blank" rel="noopener noreferrer">编辑此内容</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/10/12</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/sys-doc/shell/09.html" class="prev">
        9月
      </a></span> <span class="next"><a href="/sys-doc/shell/11.html">
        11月
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/sys-doc/assets/js/app.0aa4aa39.js" defer></script><script src="/sys-doc/assets/js/2.01d9652a.js" defer></script><script src="/sys-doc/assets/js/90.95f934a7.js" defer></script>
  </body>
</html>
